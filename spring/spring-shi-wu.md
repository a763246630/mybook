## spring事务 

什么是事务: 
事务逻辑上的一组操作,组成这组操作的各个逻辑单元,要么一起成功,要么一起失败，不存在中间状态.

#### 事务的特性

##### 原子性 （atomicity）

关注事务状态,要么一起成功,要么一起失败，不存在中间状态. 

##### 一致性 （consistency）

关注事务可见性，中间状态的数据对外不可见，只有最终和最初状态可见. 

##### 隔离性 （isolation）

一个事务执行的过程中,不应该受到其他事务的干扰 

##### 持久性（durability） 

事务提交后,数据持久化到数据库



#### 各种隔离级别可能出现的问题

##### 脏读:一个事务读到了另一个事务未提交的数据

##### 不可重复读:一个事务多次读取相同的数据得到的值不一样。

##### 幻读:一个事务修改了表中所有数据，另一个事务新增了一条数据，只是第一个事务发现还有没有修改的数据像出现了幻觉一样。



#### 事务隔离级别

##### Mysql INODB默认:可重复读 

Oracle 默认:读已提交

##### 未提交读（READ_UNCOMMITTED）

隔离级别低，并发性能高，会出现脏读，不可重复读，幻读。

##### 已提交读（READ_COMMITTED）

锁定修改行，会出现不可重复度，幻读。

##### 可重复读（REPEATABLE_READ）

锁定所有读取行，会出现幻读

##### 串行读（SERIALIZABLE）

锁表，每次只能由一个线程处理表数据。



事务的7种传播级别（Propagation）

1.REQUIERD（依赖，必须）

如果有事务支持当前事务，没有则自己创建一个事务。

2.SUPPORTS（支持）

如果有事务支持当前事务，没有则以无事务的方式执行。

3.NOT_SUPPORTD（不支持）

以非事务的方式执行操作，如果有事务存在，就把当前事务挂起。

4.REQUIRED_NEW（必须新的）

不管有没有事务，都创建新事务，原来的事务挂起，新的执行完毕，继续执行老的。

5.MANDATORY(强制)

必须在一个事务中执行，否则抛出异常。

6.NEVER（从不）

必须在一个非事务方式中执行，否则抛出异常。

7.NESTED（嵌套）

如果存在事务，则创建事务以当前事务嵌套事务运行，如果没有，则新建一个事务执行，（等价于REQUIRED）。

当执行到内部事务B，外部事务会挂起，新建一个子事务B并设置savepoint等B事务执行完，外部事务才执行。

外部事务失败，内部外部事务都会回滚。内部事务B失败回滚抛出异常被外部事务捕获未抛出则外部事务A仍可以

提交，相反未捕获则回滚。





 



